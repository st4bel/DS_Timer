{% extends "layout.html" %}
{% block title %}New Attack{% endblock %}
{% block header %}
<script type="text/javascript">
  function useTemplate(template, unitnames){
    for(var i = 0; i < unitnames.length; i++){
      var unitField = document.getElementById("unit_input_"+unitnames[i]);
      unitField.value = template.units[unitnames[i]];
    }
  }
  function source_player_selected(){
    var source_player = $("#source_player_select :selected").val();
    if (source_player != ""){
      load_source_villages(source_player);
      load_players(source_player);
    }
  }
  function load_source_villages(source_player){
    $.get("/villages_of_player/"+source_player, function(villages) {
      for (var i=0; i < villages.length;i++){
        $("#source_village").append($("<option>").text(villages[i]["name"]).attr("value",villages[i]["id"]));
      }
    })
  }
  function load_players(source_player){
    $.get("/load_players/"+source_player, function(players){
      for (var i=0; i<players.length;i++){
        $("#target_player_list").append($("<option>").attr("value", players[i]["name"]));
      }
    })
  }
  $(function() {
    {% if N_O_P == 1%}
      alert("hey");
      source_player_selected()
    {% endif %}
  });
</script>
{% endblock %}
{% block content %}

<h2>Angriff erstellen</h2>

<h3>Truppen eingeben</h3>
<div id="div_new_template">
    <form action="" method="post">
        <table class="table">
            <tbody>
                <tr>
                    <th>Spieler/Server</th><th>Start Koord</th><th>Zeit</th><th>Abschickzeit?</th>
                </tr>
                <tr>
                    <td>
                      <select id="source_player_select", name="source_player_select", onchange="source_player_selected()">
                        {% if N_O_P != 1%}
                          <option value="" selected="selected">Spieler auswählen</option>
                        {% endif %}
                        {% for player in players %}
                          <option value="{{ player.name }}+{{ player.domain }}">{{ player.name }}@{{ player.domain }}</option>
                        {% endfor %}
                      </select>
                    </td>
                    <td>
                        <input name="source_x" id="source_x" type="text" style="width: 40px"><input name="source_y" id="source_y" type="text" style="width: 40px"><br>
                        <select id="source_village" name="source_village">
                          <option value="" selected = "selected">Dorf auswählen</option>
                        </select>
                    </td>
                    <td>
                      <input name="time" type="datetime-local" step="0.25" id="time">
                    <td>
                    <td>
                      <input name="departure" type="checkbox" id="departure">
                    </td>
                </tr>
            </tbody>
        </table><br>
        <table class="table">
          <tbody>
            <tr>
              <th>Ziel Spieler</th><th>Ziel Koord</th>
            </tr>
            <tr>
              <td>
                <input list="target_player_list" value="" id="target_player" />
                <datalist id="target_player_list"></datalist>
              </td>
              <td>
                  <input name="target_x" id="target_x" type="text" style="width: 40px"><input name="target_y" id="target_y" type="text" style="width: 40px">
              </td>
            </tr>
          </tbody>
        </table><br>
        <table>
            <tbody>
                <tr><td valign="top">
                        <table class="table" width="100%"><tbody>
                            <tr><th>Infanterie</th></tr>
                            <tr><td><img src="{{ innocdn_url('/graphic/unit/unit_spear.png') }}" title="Speerträger" alt="" class=""><input id="unit_input_spear" name="spear" type="text" style="width: 40px"></td></tr>
                            <tr><td><img src="{{ innocdn_url('/graphic/unit/unit_sword.png') }}" title="Schwertkämpfer" alt="" class=""><input id="unit_input_sword" name="sword" type="text" style="width: 40px"></td></tr>
                            <tr><td><img src="{{ innocdn_url('/graphic/unit/unit_axe.png') }}" title="Axtkämpfer" alt="" class=""><input id="unit_input_axe" name="axe" type="text" style="width: 40px"></td></tr>
                            <tr><td><img src="{{ innocdn_url('/graphic/unit/unit_archer.png') }}" title="Bogenschützen" alt="" class=""><input id="unit_input_archer" name="archer" type="text" style="width: 40px"></td></tr>
                        </tbody></table>
                    </td>
                    <td valign="top">
                        <table class="table" width="100%"><tbody>
                            <tr><th>Kavallerie</th></tr>
                            <tr><td><img src="{{ innocdn_url('/graphic/unit/unit_spy.png') }}" title="Späher" alt="" class=""><input id="unit_input_spy" name="spy" type="text" style="width: 40px"></td></tr>
                            <tr><td><img src="{{ innocdn_url('/graphic/unit/unit_light.png') }}" title="Leichte Kavallerie" alt="" class=""><input id="unit_input_light" name="light" type="text" style="width: 40px"></td></tr>
                            <tr><td><img src="{{ innocdn_url('/graphic/unit/unit_marcher.png') }}" title="Berittene Bogenschützen" alt="" class=""><input id="unit_input_marcher" name="marcher" type="text" style="width: 40px"></td></tr>
                            <tr><td><img src="{{ innocdn_url('/graphic/unit/unit_heavy.png') }}" title="Schwere Kavallerie" alt="" class=""><input id="unit_input_heavy" name="heavy" type="text" style="width: 40px"></td></tr>
                        </tbody></table>
                    </td>
                    <td valign="top">
                        <table class="table" width="100%"><tbody>
                            <tr><th>Belagerung</th></tr>
                            <tr><td><img src="{{ innocdn_url('/graphic/unit/unit_ram.png') }}" title="Rammbock" alt="" class=""><input id="unit_input_ram" name="ram" type="text" style="width: 40px"></td></tr>
                            <tr><td><img src="{{ innocdn_url('/graphic/unit/unit_catapult.png') }}" title="Katapult" alt="" class=""><input id="unit_input_catapult" name="catapult" type="text" style="width: 40px"></td></tr>
                        </tbody></table>
                    </td>
                    <td valign="top">
                        <table class="table" width="100%"><tbody>
                            <tr><th>Andere</th></tr>
                            <tr><td><img src="{{ innocdn_url('/graphic/unit/unit_knight.png') }}" title="Paladin" alt="" class=""><input id="unit_input_knight" name="knight" type="text" style="width: 40px"></td></tr>
                            <tr><td><img src="{{ innocdn_url('/graphic/unit/unit_snob.png') }}" title="Adelsgeschlecht" alt="" class=""><input id="unit_input_snob" name="snob" type="text" style="width: 40px"></td></tr>
                        </tbody></table>
                    </td>
                </tr>
            </tbody>
        </table><br>
        <button type="submit" name="type" value="create_template" class="btn btn-default">Speichern</button>
    </form>
</div>
<h3>Vorlage verwenden</h3>
<table class="table">
    <tr>
        <th>Name</th>
        <th>Truppen</th>
        <th>Aktionen</th>
    </tr>
    {% for template in templates%}
    <tr>
        <td><b>{{ template.name }}</b></td>
        <td>
            <table><tr>
            {% for unitname in unitnames %}
                <td width="70px" align="right">
                    <span class="badge alert-success" title="{{unitname}}">{{template.units[unitname]}}<img src="{{ innocdn_url('/graphic/unit/unit_' + unitname + '.png') }}"></span>
                </td>
            {% endfor %}
            </tr></table>
        </td>
        <td>

                <button onclick="useTemplate({{ template }},{{ unitnames }})" name="type" value="use_{{template.id}}" class="btn btn-default">Verwenden</button>

        </td>
    </tr>
    {% endfor %}
</table>

{% endblock %}
